sudo: false
addons:
  apt:
    packages:
    - mysql-server-5.6
    - mysql-client-core-5.6
    - mysql-client-5.6

language: php
php:
  - "5.6"
  - "7.0"

sudo: false
services:
  - postgresql
  - mysql

env:
  - DB=mysqli
  - DB=pgsql
  - DB=sqlite

before_script:
  - composer install
  - sh -c "if [ '$DB' = 'mysqli' ]; then mysql -u root -e 'drop database if exists phyxo;';fi"
  - sh -c "if [ '$DB' = 'mysqli' ]; then mysql -u root -e 'create database phyxo;';fi"
  - sh -c "if [ '$DB' = 'mysqli' ]; then cp -p local/config/database.inc.mysqli.travis.php local/config/database.inc.php;fi"
  - sh -c "if [ '$DB' = 'pgsql' ]; then psql -c 'drop database if exists phyxo;' -U postgres; fi"
  - sh -c "if [ '$DB' = 'pgsql' ]; then psql -c 'create database phyxo;' -U postgres ;fi"
  - sh -c "if [ '$DB' = 'pgsql' ]; then cp -p local/config/database.inc.pgsql.travis.php local/config/database.inc.php;fi"
  - sh -c "if [ '$DB' = 'sqlite' ]; then rm -f db/phyxo.db;fi"
  - sh -c "if [ '$DB' = 'sqlite' ]; then cp -p local/config/database.inc.sqlite.travis.php local/config/database.inc.php;fi"
  - php tools/install.php
  - php -S localhost:1080 -t . &

script:
  - php ./bin/atoum
  - php ./bin/behat -c behat.yml.travis.dist
